<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Covid-19 Count</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css"
    integrity="sha512-apX8rFN/KxJW8rniQbkvzrshQ3KvyEH+4szT3Sno5svdr6E/CP0QE862yEeLBMUnCqLko8QaugGkzvWS7uNfFQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <link rel="stylesheet" href="styles.css">

</head>
<style>


</style>

<body>
  <header class="mt-4 p-2">
    <h2 class="text-center heading p-5" id="heading">Daily cases of Covid19 <i class="fas fa-virus"></i></h2>
  </header>
  <main style="padding: 0% 2%;">
    <div class="container-fluid mt-1 mb-5">
    
      <div class="row">
        <div class="col-12 row mt-3 ">
          <div class="col-12">
            <select class="form-control form-control-lg selectList" id="myStateList" onchange="showData()">
              <option value='TT' selected>India</option>
            </select>
          </div>
          <!-- <div class="col-2 center-center">
            <a href="" class="link">Show Details</a>
          </div> -->
        </div>
      </div>

      <div class="row mt-3 text-center">
        
        <div class="col-12 col-sm-6 col-md-3 p-2 mt-2" >
          <div class="p-2 bg-confirm myCard">
            <div class="card-text-heading mb-2">Total Cases &nbsp;<i class="fas fa-bacteria"></i></div>
            <div id="deltatotalcases" class="delta-text mb-1"></div>
            <div id="totalcases"></div>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-md-3 p-2 mt-2" >
          <div class="p-2 bg-active myCard">
            <div class="card-text-heading">Active Cases &nbsp;<i class="fas fa-bed"></i></div>
            <div id="deltatotalactivecases" class="delta-text"></div>
            <div id="totalactivecases"></div>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-md-3 p-2 mt-2" >
          <div class="p-2 bg-recovery myCard">
            <div class="card-text-heading">Recovery &nbsp;<i class="fas fa-child"></i></div>
            <div id="deltatotalrecovery" class="delta-text"></div>
            <div id="totalrecovery"></div>
          </div>
        </div>
        <div class="col-12 col-sm-6 col-md-3 p-2 mt-2" >
          <div class="p-2 bg-death myCard">
            <div class="card-text-heading">Deaths &nbsp;<i class="fas fa-praying-hands"></i></div>
            <div id="deltatotaldeaths" class="delta-text"></div>
            <div id="totaldeaths"></div>
          </div>
        </div>
        <div class="col-12 text-right">
          Last updated on: <span id="last-update"></span>
        </div>
      </div>

      <div class="row mt-5 text-center">
        
        <div class="col-12 text-left">
          <h3><i class="fas fa-stream"></i>&nbsp;Statewise Data:</h3>
        </div>

        <div class="col-12 p-2">
          <div class="table-responsive">
            <table class="table  table-striped table-hover" id="myTable">
              <thead>
                <tr>
                  <th scope="col" class="sticky-th" >State</th>
                  <th scope="col" class="bg-confirm">Confirmed</th>
                  <th scope="col" class="bg-active">Active</th>
                  <th scope="col" class="bg-recovery">Recovered</th>
                  <th scope="col" class="bg-death">Deaths</th>
                  <th scope="col" class="bg-light">Details</th>
                </tr>
              </thead>
              
              <tbody>
                <!-- <tr>
                  <th scope="row" class="sticky-th">1</th>
                  <td>Mark</td>
                  <td>Otto</td>
                  <td>@mdo</td>
                  <td>@mdo</td>
                </tr> -->
              </tbody>
  
            </table>
          </div>

        </div>
      </div>
      
      
    </div>
  </main>
  <hr>
  <footer class="mt-5 mb-5 w-100 text-center">
    <div>Made by Debendu Das<br />(email: debendudas100@gmail.com)<br /> with HTML, CSS, Bootstrap and JavaScript</div>
  </footer>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

  <script>

    let data = {}
    let stateName = {  'TT' :  'India' ,   'AN' :  'Andaman and Nicobar Islands',   'AP' :  'Andhra Pradesh',   'AR' :  'Arunachal Pradesh',   'AS' :  'Assam',   'BR' :  'Bihar',   'CH' :  'Chandigarh',   'CT' :  'Chhattisgarh',   'DN' :  'Dadra and Nagar Haveli and Daman and Diu',   'DL' :  'Delhi',   'GA' :  'Goa',   'GJ' :  'Gujarat',   'HR' :  'Haryana',   'HP' :  'Himachal Pradesh',   'JK' :  'Jammu and Kashmir',   'JH' :  'Jharkhand',   'KA' :  'Karnataka',   'KL' :  'Kerala',   'LA' :  'Ladakh',   'LD' :  'Lakshadweep',   'MP' :  'Madhya Pradesh',   'MH' :  'Maharashtra',   'MN' :  'Manipur',   'ML' :  'Meghalaya',   'MZ' :  'Mizoram',   'NL' :  'Nagaland',   'OR' :  'Odisha',   'PY' :  'Puducherry',   'PB' :  'Punjab',   'RJ' :  'Rajasthan',   'SK' :  'Sikkim',   'UN' :  'State Unassigned',   'TN' :  'Tamil Nadu',   'TG' :  'Telangana',   'TR' :  'Tripura',   'UP' :  'Uttar Pradesh',   'UT' :  'Uttarakhand',   'WB' :  'West Bengal' }
    
    $(document).ready(function () {

      $.ajax({
        url: 'https://api.covid19india.org/v4/min/data.min.json',
        method: 'GET',
        cache: false,
        success: function (response) {
          console.log("API response", response);
          data = response
          
          createStateList()
          showData()
          createTable()
        }
        
      })
      
    })
    
    function createStateList() {
      let stateList = document.getElementById('myStateList');

      for(let state in data) {
        let option = document.createElement('option')
        option.text = stateName[state]
        option.value = state
        stateList.add(option)
      }
    }


    function showData(){
      let x = document.getElementById("myStateList").selectedIndex
      let selectedState = document.getElementsByTagName("option")[x].value

      // console.log(selectedState, data[selectedState])
      let activecase = 0

      data[selectedState].delta != undefined && data[selectedState].delta.confirmed != undefined && data[selectedState].delta.confirmed > 0 ?
        $('#deltatotalcases').html('<i class="fas fa-arrow-up"></i>  ' + data[selectedState].delta.confirmed)
        :$('#deltatotalcases').html('')
        

      activecase = data[selectedState].delta && data[selectedState].delta.confirmed && data[selectedState].delta.recovered && data[selectedState].delta.deceased ? data[selectedState].delta.confirmed - data[selectedState].delta.recovered - data[selectedState].delta.deceased : 0
      activecase != 0 ? activecase > 0 ?
        $('#deltatotalactivecases').html('<i class="fas fa-arrow-up"></i>  ' + activecase)
        : $('#deltatotalactivecases').html('<i class="fas fa-arrow-down"></i>  ' + activecase)
      : $('#deltatotalactivecases').html('')

      data[selectedState].delta != undefined && data[selectedState].delta.recovered != undefined && data[selectedState].delta.recovered > 0 ?
        $('#deltatotalrecovery').html('<i class="fas fa-arrow-up"></i>  ' + data[selectedState].delta.recovered)
        :$('#deltatotalrecovery').html('')

        data[selectedState].delta != undefined && data[selectedState].delta.deceased != undefined && data[selectedState].delta.deceased > 0 ?
        $('#deltatotaldeaths').html('<i class="fas fa-arrow-up"></i>  ' + data[selectedState].delta.deceased)
        :$('#deltatotaldeaths').html('')
        

      $('#totalcases').html(data[selectedState].total.confirmed)
      activecase = data[selectedState].total.confirmed - data[selectedState].total.recovered - data[selectedState].total.deceased
      $('#totalactivecases').html(activecase)
      $('#totalrecovery').html(data[selectedState].total.recovered)
      $('#totaldeaths').html(data[selectedState].total.deceased)
      $('#last-update').html(Date(data[selectedState].meta.last_updated))
    
    }

    function createTable() {

      let table = document.getElementById("myTable").getElementsByTagName('tbody')[0]

      for(let state in data) {

        if(state == 'TT')
          continue

        let row = table.insertRow()     
        
        // State
        let th = document.createElement('th')
        th.innerHTML = stateName[state]
        th.setAttribute('scope', 'row')
        th.classList.add('sticky-th')
        row.appendChild(th)
        
        // Confirmed
        let i = document.createElement('div')
        i.classList.add('delta-confirm-text')
        let j = document.createElement('div')
        
        i.innerHTML = (data[state].delta != undefined && data[state].delta.confirmed != undefined) ? ('<i class="fas fa-arrow-up"></i>' + data[state].delta.confirmed) : ''
        j.innerHTML = data[state].total.confirmed

        let m = row.insertCell(1)
        m.appendChild(i)
        m.appendChild(j)
        
        // Active
        i = document.createElement('div')
        i.classList.add('delta-active-text')
        j = document.createElement('div')
        
        let activecase = data[state].delta && data[state].delta.confirmed && data[state].delta.recovered && data[state].delta.deceased ? data[state].delta.confirmed - data[state].delta.recovered - data[state].delta.deceased : 0
        i.innerHTML = data[state].delta && activecase ? (activecase > 0) ? ('<i class="fas fa-arrow-up"></i>' + activecase) : ('<i class="fas fa-arrow-down"></i>' + activecase) : ''
        j.innerHTML = data[state].total.confirmed - data[state].total.recovered - data[state].total.deceased

        m = row.insertCell(2)
        m.appendChild(i)
        m.appendChild(j)

        // Recovery
        i = document.createElement('div')
        i.classList.add('delta-recovery-text')
        j = document.createElement('div')
        
        i.innerHTML = (data[state].delta != undefined && data[state].delta.recovered != undefined ) ? ('<i class="fas fa-arrow-up"></i>' + data[state].delta.recovered) : ''
        j.innerHTML = data[state].total.recovered

        m = row.insertCell(3)
        m.appendChild(i)
        m.appendChild(j)

        // Death
        i = document.createElement('div')
        i.classList.add('delta-death-text')
        j = document.createElement('div')
        
        i.innerHTML = (data[state].delta != undefined  && data[state].delta.deceased != undefined ) ? '<i class="fas fa-arrow-up"></i>' + data[state].delta.deceased : ''
        j.innerHTML = data[state].total.deceased

        m = row.insertCell(4)
        m.appendChild(i)
        m.appendChild(j)

        // Details
        i = document.createElement('a')
        i.setAttribute('href','./state.html?state='+state+'/');
        i.innerText = "See Details";

        m = row.insertCell(5)
        m.appendChild(i)
        
      }
      // let row = table.insertRow()     
      
      // let th = document.createElement('th');
      // th.innerHTML = stateName['TT']
      // th.setAttribute('scope', 'row')
      // th.classList.add('sticky-th')
      // row.appendChild(th)
      
      // i.innerHTML = (data[state].delta != undefined && data[state].delta.recovered != undefined ) ? ('<i class="fas fa-arrow-up"></i>' + data[state].delta.recovered) : ''
      // j.innerHTML = data[state].total.recovered

      // m = row.insertCell(3)
      // m.appendChild(i)
      // m.appendChild(j)

      // row.insertCell(1).innerHTML = data['TT'].total.confirmed 
      // let activecase = data['TT'].total.confirmed - data['TT'].total.recovered - data['TT'].total.deceased
      // row.insertCell(2).innerHTML = activecase           
      // row.insertCell(3).innerHTML = data['TT'].total.recovered         
      // row.insertCell(4).innerHTML = data['TT'].total.deceased 
      
    }
  </script>

</body>


</html>